# 版本历史记录

本文档记录了健身语音计数器应用的所有版本变更历史。

## [1.0.0] - 2025-11-18

### 🎉 初始功能版本

这是健身语音计数器应用的第一个正式版本，包含以下主要功能：

### ✨ 新增功能

#### 语音控制功能
- **语音命令识别**：支持语音命令控制应用（如："倒數10秒"）
- **倒计时功能**：通过语音命令启动倒计时，支持1-60秒倒计时
- **语音播报**：倒计时和计数过程中自动语音播报秒数
  - 支持自定义播报间隔（1秒、5秒、10秒、15秒、30秒）
  - 超过60秒时自动转换为"分钟+秒"格式播报
  - 播报间隔为1秒时，只播报数字，不播报"秒"
- **停止功能**：支持语音命令停止计数（"停"、"停止"、"结束"）

#### 记录管理功能
- **记录保存**：运动结束后可以保存记录到本地数据库
- **日历视图**：使用日历方式查看历史记录
  - 有记录的日期会标记绿点
  - 支持点击日期查看当日所有记录
- **记录列表**：显示每条记录的详细信息
  - 显示运动时长（分钟和秒）
  - 显示运动时间（小时:分钟）
  - 支持删除记录功能

#### 设置功能
- **播报间隔设置**：可选择每秒、每5秒、每10秒、每15秒、每30秒播报
- **监听开始时间设置**：可设置从第几分钟开始监听（0-60分钟，使用滑动选择器）
- **版本信息显示**：显示版本号、构建时间、构建日期

### 🐛 错误修复

- **语音识别并发问题**：修复了计数过程中语音识别频繁重启导致的崩溃问题（`recursive_mutex lock failed`）
- **会话停用失败**：修复了监听会话停用失败的问题
- **错误处理改进**：改进了语音识别错误处理逻辑
  - 将 `error_no_match`、`no speech detected` 等可忽略错误添加到忽略列表
  - 在计数过程中，非停止命令不会被识别为错误
  - 静默处理可忽略的错误，避免误导用户
- **版本信息显示**：修复了构建时间和日期显示逻辑

### 🔧 技术改进

#### 数据结构
- 使用 **SQLite** (`sqflite`) 存储运动记录
- 创建了完整的记录数据模型（`Record`）和数据库管理类（`RecordDatabase`）

#### UI组件
- 使用 **table_calendar** 实现日历视图
- 使用 **intl** 进行日期格式化
- 优化了设置界面的交互体验（滑动选择器替代单选按钮）

#### 并发控制
- 添加 `_isRestartingListening` 标志防止并发调用
- 改进了 `_keepListening()` 方法，确保完全停止后再重启监听
- 添加 `_scheduleRestartListening()` 统一处理监听重启逻辑
- 增加了适当的延迟，避免频繁重启导致的系统资源竞争

#### 错误处理
- 改进了语音识别初始化流程
- 添加了初始化状态跟踪（`_speechInitialized`）
- 优化了监听启动和停止的时序控制

#### 构建系统
- 创建了构建信息生成脚本（`scripts/generate_build_info.sh`）
- 创建了构建信息恢复脚本（`scripts/restore_build_info.sh`）
- 实现了构建时间和日期的自动生成

### 📦 依赖项

#### 新增依赖
- `sqflite: ^2.3.0` - SQLite 数据库支持
- `path: ^1.8.3` - 路径处理
- `table_calendar: ^3.0.9` - 日历组件
- `intl: ^0.18.1` - 国际化支持

#### 现有依赖
- `speech_to_text: ^7.0.0` - 语音识别
- `flutter_tts: ^4.0.2` - 文本转语音

### 📱 平台支持

- ✅ iOS 13.0+

### 📝 已知问题

无

### 🚀 未来计划

功能将持续改进和优化

---

## 提交历史

### 2025-11-18
- `fbc63ea` - feat: 添加记录保存和日历查看功能，修复语音识别并发问题

---

**格式说明：**
- 🎉 表示重要版本
- ✨ 表示新功能
- 🐛 表示错误修复
- 🔧 表示技术改进
- 📦 表示依赖变更
- 📱 表示平台支持
- 📝 表示文档或说明

